<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyBlock</title>
    <link rel="stylesheet" href="apt.css">
    <link href="https://fonts.googleapis.com/css2?family=Funnel+Display:wght@300..800&display=swap" rel="stylesheet">
</head>
<body>
    <h1 style="color: #b0b0b0;">Please fill out your details:</h1>

    <form id="apartment-form">
        <label for="Name" class="questions">Your Name:</label>
        <input type="text" name="name" id="Name" required placeholder="Your Full Name">
        
        <label for="building" class="questions">Select Your Building:</label>
        <div class="radio-group">
            <input type="radio" name="building" value="A" id="buildingA" required> 
            <label for="buildingA" class="building-question">Building A</label>
            <input type="radio" name="building" value="B" id="buildingB" required> 
            <label for="buildingB" class="building-question">Building B</label>
        </div>
        
        <label for="Floor" class="questions">Your Floor:</label>
        <select name="Floor" id="Floor" required>
            <option value="" class="building-question">Select Floor...</option>
            <option value="Floor 1">Floor 1</option>
            <option value="Ground Floor">Ground Floor</option>
        </select>
        
        <input type="submit" value="Check Availability" id="Reside-Button">
    </form>

    <div class="residents-section">
        <div class="residents-title">Current Residents</div>
        <div id="residents-list"></div>
        <button id="clear-all" class="clear-all-btn" onclick="clearAllResidents()">Clear All Residents</button>
    </div>

    <!-- Firestore Integration -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
      import { getFirestore, collection, addDoc, getDocs, onSnapshot, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-firestore.js";

      // Firebase config
      const firebaseConfig = {
        apiKey: "AIzaSyA3iPCykkBynU6n1sbqaI67auU1CeSsrm0",
        authDomain: "myblox-app.firebaseapp.com",
        projectId: "myblox-app",
        storageBucket: "myblox-app.firebasestorage.app",
        messagingSenderId: "94559433237",
        appId: "1:94559433237:web:48be37bca154ccbc81141c",
        measurementId: "G-B544Z7V6Y4"
      };

      // Init Firebase + Firestore
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      const form = document.getElementById("apartment-form");
      const residentsList = document.getElementById("residents-list");

      // Add resident
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        const name = document.getElementById("Name").value.trim();
        const building = document.querySelector("input[name='building']:checked")?.value;
        const floor = document.getElementById("Floor").value;

        if (!name || !building || !floor) return;

        try {
          await addDoc(collection(db, "residents"), { name, building, floor });
          form.reset();
        } catch (err) {
          console.error("Error adding resident:", err);
        }
      });

      // Live updates
      onSnapshot(collection(db, "residents"), (snapshot) => {
        residentsList.innerHTML = "";
        snapshot.forEach((docSnap) => {
          const data = docSnap.data();
          const div = document.createElement("div");
          div.textContent = `${data.name} â€” Building ${data.building}, ${data.floor}`;
          residentsList.appendChild(div);
        });
      });

      // Clear all
      window.clearAllResidents = async () => {
        const querySnapshot = await getDocs(collection(db, "residents"));
        querySnapshot.forEach(async (docSnap) => {
          await deleteDoc(doc(db, "residents", docSnap.id));
        });
      };
    </script>
</body>
</html>
